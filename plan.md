# 7天Shell实现学习计划 - 详细知识点

## 第1天: C语言基础与文件I/O
### C语言基础回顾
- 数据类型与变量: char, int, bool, 数组, 指针
- 字符串处理: 字符数组vs std::string, strlen(), strcpy(), strcmp()
- 内存管理: malloc(), free(), 栈与堆
- 函数与递归: 参数传递, 返回值, 递归调用

### 文件I/O基础
- 文件描述符概念: stdin(0), stdout(1), stderr(2)
- 基本I/O函数: open(), close(), read(), write()
- 高级I/O: dup(), dup2(), fcntl()
- 标准I/O库: fopen(), fclose(), fgets(), fprintf()
- 文件权限与模式: O_RDONLY, O_WRONLY, O_CREAT, 0644权限

### 实践练习
- 实现简单的文件复制程序
- 创建一个基本的命令行读取循环
- 实现输入/输出重定向功能(>, <)

## 第2天: 进程控制基础
### 进程基础
- 进程概念: 进程ID, 父子关系
- 进程创建: fork()系统调用及返回值处理
- 进程执行: exec族函数(execvp, execve等)
- 进程等待: wait(), waitpid()
- 进程终止: exit(), _exit()

### 环境变量与参数
- 环境变量访问: getenv(), environ全局变量
- 环境变量修改: setenv(), putenv()
- 命令行参数: argc, argv处理
- 当前目录操作: getcwd(), chdir()

### 实践练习
- 实现简单的命令执行功能(不带参数)
- 添加对命令参数的支持
- 实现cd内建命令
- 实现环境变量展开(如$HOME)

## 第3天: 管道与信号
### 管道通信
- 管道概念: 单向数据流, 父子进程通信
- 管道创建: pipe()系统调用
- 管道重定向: 连接标准输入/输出
- 多级管道处理: 递归或迭代方法

### 信号处理
- 信号概念: SIGINT, SIGCHLD等常见信号
- 信号处理器: signal(), sigaction()
- 信号屏蔽与等待: sigprocmask(), sigsuspend()
- 子进程状态变化处理

### 实践练习
- c
- 添加对多级管道的支持(cmd1 | cmd2 | cmd3)
- 实现基本的信号处理(Ctrl+C不终止shell)
- 处理僵尸进程问题

## 第4天: 命令解析与字符串处理
### 命令行解析
- 词法分析: 分割命令行为标记(tokens)
- 语法分析: 识别命令、参数、重定向、管道
- 引号处理: 单引号、双引号、转义字符
- 通配符展开: *, ?等模式匹配

### 重定向实现
- 输入重定向(<): 从文件读取而非标准输入
- 输出重定向(>): 写入文件而非标准输出
- 追加重定向(>>): 追加到文件末尾
- 错误重定向(2>): 重定向标准错误
- 文件描述符复制(>&): 复制文件描述符

### 实践练习
- 改进命令解析器支持引号和转义
- 实现所有重定向类型
- 添加对后台执行的支持(&)
- 实现简单的通配符展开

## 第5天: Shell内建命令与作业控制
### 内建命令实现
- cd: 改变当前工作目录
- pwd: 显示当前工作目录
- exit: 退出shell
- export: 设置环境变量
- source/.: 执行脚本文件
- history: 命令历史记录

### 作业控制基础
- 作业概念: 前台/后台作业
- 作业表管理: 跟踪进程组
- 作业状态变化: 运行、停止、终止
- 作业控制命令: jobs, fg, bg, kill

### 实践练习
- 实现所有基本内建命令
- 创建作业表数据结构
- 实现jobs命令显示后台作业
- 添加fg/bg命令支持

## 第6天: 高级功能与错误处理
### 高级功能
- 命令别名(alias)
- 命令历史与重用(!!)
- 命令补全功能
- 管道行为优化

### 错误处理与调试
- 系统调用错误检查
- 内存泄漏防止
- 边界情况处理
- 调试技术与工具

### 实践练习
- 实现命令历史功能
- 添加简单的命令补全
- 全面检查错误处理
- 修复已知bug

## 第7天: 整合与完善
### 代码重构
- 模块化设计
- 代码清理与注释
- 性能优化

### 功能测试
- 创建测试用例
- 边界条件测试
- 与标准shell比较

### 扩展功能(选做)
- 脚本执行支持
- 更多内建命令
- 作业控制高级功能
- 自定义提示符

### 最终交付
- 完整功能测试
- 文档编写
- 示例演示

## 学习资源
- 《UNIX环境高级编程》(Stevens & Rago)
- 《Linux/UNIX系统编程手册》(Kerrisk)
- Linux man pages (特别是第2和第3部分)
- GNU Bash源代码
- 开源shell实现(dash, ash等)

- 任务一：文件描述符基础操作
编写一个程序，打印出标准输入、标准输出和标准错误的文件描述符值
使用write()函数向标准输出和标准错误分别写入不同的消息
尝试关闭标准输出，然后观察write()函数的返回值和错误信息
- 任务二：文件读写操作
创建一个程序，使用open()、write()和close()函数创建一个文本文件并写入一些内容
2. 扩展程序，使用open()、read()和close()函数读取刚才创建的文件内容并显示
- 尝试使用不同的文件权限模式创建文件，观察文件的访问权限变化
- 任务三：文件重定向实现
编写一个程序，使用dup2()函数将标准输出重定向到一个文件
扩展程序，实现将标准输入从一个文件重定向
实现一个简单的"tee"命令功能：从标准输入读取内容，同时输出到标准输出和指定文件
- 任务四：管道通信基础
创建一个程序，使用pipe()函数创建一个管道
使用fork()创建子进程，让父进程向管道写入数据，子进程从管道读取数据
- 扩展程序，实现一个简单的命令管道：让一个进程的输出成为另一个进程的输入
- 任务五：综合应用
实现一个简单的"cat"命令，能够读取文件内容并显示
扩展"cat"命令，支持从标准输入读取内容（当没有提供文件名参数时）
添加对输入/输出重定向的支持，如：./mycat input.txt > output.txt


# dup2()：复制文件描述符，用于重定向
重定向实现
输入重定向(<)：将文件内容作为命令的输入
输出重定向(>)：将命令的输出写入文件
3. 字符串处理
字符串函数
strcspn()：查找字符串中第一个匹配字符的位置，用于去除换行符
strlen()：获取字符串长度
strcmp()：比较字符串，用于命令识别
strtok()：分割字符串，用于解析命令行参数
4. 内存管理
数组与指针
字符数组：存储输入命令
指针数组：存储解析后的命令参数
动态内存分配：虽然基础版未使用，但在更复杂的Shell中常用
5. 环境变量与目录操作
环境变量
getenv()：获取环境变量，如在builtin_cd()中获取HOME目录
目录操作
getcwd()：获取当前工作目录
chdir()：改变当前工作目录